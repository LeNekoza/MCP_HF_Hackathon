# üè• Hospital Data Schema & Query Guide

> **Purpose**
>
> This markdown document provides Large Language Models (LLMs) with the structural context they need to interpret end‚Äëuser questions about hospital data‚Äî**even when users omit explicit table names.** Keep this file in the system prompt or as a reference chunk so the model can reason about where each data point lives.

---

## 1. Datasets at a Glance

| Table (CSV file)     | Row count\* | Primary Key | Brief Purpose                                                    |
| -------------------- | ----------: | ----------- | ---------------------------------------------------------------- |
| `users`              |       3‚ÄØ210 | `id`        | All people in the system (patients **and** staff)                |
| `patient_records`    |       3‚ÄØ000 | `id`        | One row per patient medical profile; links to **users**          |
| `rooms`              |         150 | `id`        | Physical rooms/wards with static attributes                      |
| `occupancy`          |       1‚ÄØ100 | `id`        | Historical log of which patient occupied which room/bed and when |
| `storage_rooms`      |          50 | `id`        | Storage locations for supplies and equipment                     |
| `hospital_inventory` |         100 | `id`        | Consumables (e.g. blood units, oxygen) stored in `storage_rooms` |
| `tools`              |         500 | `id`        | Re‚Äëusable medical equipment (infusion pumps, monitors, ‚Ä¶)        |

\*Row counts are approximate as of the CSV snapshots included with this documentation.

---

## 2. Detailed Table Schemas

### 2.1 `users`

| Column              | Type                              | Notes                                        |
| ------------------- | --------------------------------- | -------------------------------------------- |
| `id`                | `BIGINT`                          | Primary key                                  |
| `full_name`         | `VARCHAR(255)`                    |                                              |
| `email`             | `VARCHAR(255)`                    | Unique                                       |
| `phone_number`      | `JSONB`                           | `{ "primary": "+91‚Ä¶", "type": "mobile" }`    |
| `emergency_contact` | `JSONB`                           | `{ "name": ‚Ä¶, "phone": ‚Ä¶ }`                  |
| `password_hash`     | `TEXT`                            |                                              |
| `role`              | `ENUM('patient','staff','admin')` |                                              |
| `staff_type`        | `VARCHAR`                         | e.g. *doctor*, *nurse* (only for staff rows) |

---

### 2.2 `patient_records`

| Column              | Type                                              | Notes                                          |
| ------------------- | ------------------------------------------------- | ---------------------------------------------- |
| `id`                | `BIGINT`                                          | PK                                             |
| `user_id`           | `BIGINT`                                          | FK ‚Üí `users.id`                                |
| `date_of_birth`     | `DATE`                                            | *DD‚ÄëMM‚ÄëYYYY* format in CSV                     |
| `gender`            | `CHAR(1)`                                         | `M` / `F`                                      |
| `blood_group`       | `ENUM('A+','A‚àí','B+','B‚àí','O+','O‚àí','AB+','AB‚àí')` |                                                |
| `allergies`         | `TEXT`                                            | Free text; comma‚Äëseparated list                |
| `medical_history`   | `TEXT / JSONB`                                    |                                                |
| `emergency_contact` | `JSONB`                                           | Overrides `users.emergency_contact` if present |
| `contact_phone`     | `JSONB`                                           | Overrides `users.phone_number` if present      |

> **üîë¬†Blood group counts live here.** For a question like ‚Äú*How many B+ do we have?*‚Äù default to counting rows in `patient_records` where `blood_group = 'B+'`.

---

### 2.3 `rooms`

| Column              | Type      | Notes                             |
| ------------------- | --------- | --------------------------------- |
| `id`                | `BIGINT`  | PK                                |
| `room_number`       | `VARCHAR` | Human‚Äëreadable code (e.g. *R205*) |
| `room_type`         | `VARCHAR` | *ICU*, *General*, *Pediatric*, ‚Ä¶  |
| `bed_capacity`      | `INT`     |                                   |
| `table_count`       | `INT`     | Side tables/desks                 |
| `has_oxygen_outlet` | `BOOLEAN` |                                   |
| `floor_number`      | `INT`     |                                   |
| `notes`             | `TEXT`    |                                   |
| `Unnamed:*`         | *NULL*    | CSV artefacts‚Äîignore              |

---

### 2.4 `occupancy`

| Column               | Type        | Notes                                              |
| -------------------- | ----------- | -------------------------------------------------- |
| `id`                 | `BIGINT`    | PK                                                 |
| `room_id`            | `BIGINT`    | FK ‚Üí `rooms.id`                                    |
| `bed_number`         | `INT`       |                                                    |
| `patient_id`         | `BIGINT`    | FK ‚Üí `users.id` (only rows where `role='patient'`) |
| `attendee`           | `JSONB`     | Primary nurse / physician, shift info              |
| `assigned_at`        | `TIMESTAMP` | *DD‚ÄëMM‚ÄëYYYY HH\:MM*                                |
| `discharged_at`      | `TIMESTAMP` | May be `NULL` if ongoing                           |
| `tools`              | `JSONB`     | Equipment assigned during stay                     |
| `hospital_inventory` | `JSONB`     | Consumables allocated                              |
| `Unnamed:*`          | *NULL*      | Ignore                                             |

---

### 2.5 `storage_rooms`

| Column           | Type      | Notes                                        |
| ---------------- | --------- | -------------------------------------------- |
| `id`             | `BIGINT`  | PK                                           |
| `storage_number` | `VARCHAR` | Code e.g. *ST20001*                          |
| `storage_type`   | `VARCHAR` | *Medical Equipment Storage*, *Blood Bank*, ‚Ä¶ |
| `floor_number`   | `INT`     |                                              |
| `capacity`       | `INT`     | Max items                                    |
| `notes`          | `TEXT`    |                                              |
| `Unnamed:*`      | *NULL*    | Ignore                                       |

---

### 2.6 `hospital_inventory`

| Column                 | Type                                                           | Notes                                  |
| ---------------------- | -------------------------------------------------------------- | -------------------------------------- |
| `id`                   | `BIGINT`                                                       | PK                                     |
| `item_name`            | `VARCHAR`                                                      | *Blood Type O‚àí¬†1*, *Oxygen Cylinder 3* |
| `item_type`            | `ENUM('blood_unit','oxygen_tank','medicine','misc_equipment')` |                                        |
| `quantity_total`       | `INT`                                                          | Total on hand                          |
| `quantity_available`   | `INT`                                                          | Currently unused                       |
| `location_storage_id`  | `BIGINT`                                                       | FK ‚Üí `storage_rooms.id`                |
| `location_description` | `VARCHAR`                                                      | Mirrors¬†`storage_rooms.storage_type`   |
| `details`              | `TEXT`                                                         |                                        |
| `expiry_date`          | `DATE`                                                         | Blood & meds only                      |

> **üîë¬†Blood *inventory* counts live here.** For ‚Äú*How many B+ blood bags are in stock?*‚Äù filter `item_type='blood_unit'` and pattern‚Äëmatch `item_name`.

---

### 2.7 `tools`

| Column                  | Type      | Notes                       |
| ----------------------- | --------- | --------------------------- |
| `id`                    | `BIGINT`  | PK                          |
| `tool_name`             | `VARCHAR` |                             |
| `description`           | `TEXT`    |                             |
| `category`              | `VARCHAR` | *Surgical*, *Diagnostic*, ‚Ä¶ |
| `quantity_total`        | `INT`     |                             |
| `quantity_available`    | `INT`     |                             |
| `location_storage_id`   | `BIGINT`  | FK¬†‚Üí `storage_rooms.id`     |
| `location_description`  | `VARCHAR` |                             |
| `purchase_date`         | `DATE`    |                             |
| `last_maintenance_date` | `DATE`    |                             |
| `Unnamed:*`             | *NULL*    | Ignore                      |

---

## 3. Inter‚ÄëTable Relationships (Text Diagram)

```
users ‚îÄ‚î¨‚îÄ< patient_records
       ‚îÇ      ‚ñ≤
       ‚îÇ      ‚îÇ
       ‚îÇ   occupancy >‚îÄ‚îÄ rooms
       ‚îÇ
       ‚îî‚îÄ< occupancy

storage_rooms ‚îÄ‚îÄ< hospital_inventory
storage_rooms ‚îÄ‚îÄ< tools
```

* **Arrow key**: `A ‚îÄ< B` means *A* has one‚Äëto‚Äëmany relationship with *B* (i.e. `B` stores the foreign key).

---

## 4. Query Interpretation Rules for the LLM

1. **Blood group counts** ‚Üí `patient_records.blood_group`.
2. **Blood unit stock** ‚Üí `hospital_inventory` where `item_type='blood_unit'`.
3. **Room capacity/availability** ‚Üí join `rooms` and `occupancy`.
4. **Equipment availability** ‚Üí `tools.quantity_available`.
5. Always check for `role='patient'` when joining `users` to medical tables.

---

## 5. Data Quality & Parsing Notes

* **Date formats** vary: `DATE` columns use *DD‚ÄëMM‚ÄëYYYY*; `TIMESTAMP` uses *DD‚ÄëMM‚ÄëYYYY HH\:MM*.
* Columns named `Unnamed:*` are artefacts‚Äîignore.
* Some JSONB columns store nested objects; parse them before field‚Äëlevel filtering.

---

*Last updated:* 7¬†June¬†2025 (Asia/Kolkata)

---

### ‚ú®¬†Usage Example for an LLM

> **User:** *How many B+ do we have?*
>
> **LLM reasoning:**
>
> 1. Ambiguous term ‚ÄúB+‚Äù ‚Üí most likely **blood group**.
> 2. Blood groups stored in `patient_records.blood_group`.
> 3. Construct query A (see ¬ß5) and return count.
>
> *(If the user explicitly mentions *blood bags*, switch to query¬†B.)*

---

### License

Internal hospital analytics only. Not for external distribution.
